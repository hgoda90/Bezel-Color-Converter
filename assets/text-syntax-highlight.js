const textarea1 = document.getElementById("dropText");
const textarea2 = document.getElementById("dropText2");
const textarea3 = document.getElementById("dropText3");
const textarea4 = document.getElementById("dropText4");
const textarea5 = document.getElementById("dropText5");
const textarea6 = document.getElementById("dropText6");
const textarea7 = document.getElementById("dropText7");
const textarea8 = document.getElementById("dropText8");
const textarea9 = document.getElementById("dropText9");
const textarea10 = document.getElementById("dropText10");
const textarea11 = document.getElementById("dropText11");
const textarea12 = document.getElementById("dropText12");
const textarea13 = document.getElementById("dropText13");
const codeBlock1 = document.getElementById("codeBlock1");
const codeBlock2 = document.getElementById("codeBlock2");
const codeBlock3 = document.getElementById("codeBlock3");
const codeBlock4 = document.getElementById("codeBlock4");
const codeBlock5 = document.getElementById("codeBlock5");
const codeBlock6 = document.getElementById("codeBlock6");
const codeBlock7 = document.getElementById("codeBlock7");
const codeBlock8 = document.getElementById("codeBlock8");
const codeBlock9 = document.getElementById("codeBlock9");
const codeBlock10 = document.getElementById("codeBlock10");
const codeBlock11 = document.getElementById("codeBlock11");
const codeBlock12 = document.getElementById("codeBlock12");
const codeBlock13 = document.getElementById("codeBlock13");

// copy code from textarea to code block
function updateCode() {

	let content = textarea1.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock1.innerHTML = content;
	codeBlock1.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode2() {

	let content = textarea2.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock2.innerHTML = content;
	codeBlock2.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode3() {

	let content = textarea3.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock3.innerHTML = content;
	codeBlock3.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode4() {

	let content = textarea4.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock4.innerHTML = content;
	codeBlock4.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode5() {

	let content = textarea5.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock5.innerHTML = content;
	codeBlock5.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode6() {

	let content = textarea6.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock6.innerHTML = content;
	codeBlock6.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode7() {

	let content = textarea7.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock7.innerHTML = content;
	codeBlock7.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode8() {

	let content = textarea8.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock8.innerHTML = content;
	codeBlock8.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode9() {

	let content = textarea9.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock9.innerHTML = content;
	codeBlock9.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode10() {

	let content = textarea10.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock10.innerHTML = content;
	codeBlock10.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode11() {

	let content = textarea11.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock11.innerHTML = content;
	codeBlock11.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode12() {

	let content = textarea12.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock12.innerHTML = content;
	codeBlock12.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
}

// copy code from textarea to code block
function updateCode13() {

	let content = textarea13.value;

	// encode the special characters 
	content = content.replace(/&/g, '&amp;');
	content = content.replace(/</g, '&lt;');
	content = content.replace(/>/g, '&gt;');

	// fill the encoded text to the code
	codeBlock13.innerHTML = content;
	codeBlock13.removeAttribute("data-highlighted");

	// call highlight.js to render the syntax highlighting
	highlightJS();
	codeBlock13.removeAttribute("data-highlighted");
}

// syntax highlight
function highlightJS() {
	document.querySelectorAll('pre code').forEach((el) => {
		hljs.highlightElement(el);
	});
}

// detect content changes in the textarea
textarea1.addEventListener("input", () => {
	updateCode();
});

// sync the scroll bar position between textarea and code block
textarea1.addEventListener("scroll", () => {
	codeBlock1.scrollTop = textarea1.scrollTop;
	codeBlock1.scrollLeft = textarea1.scrollLeft;
});

 textarea2.addEventListener("input", () => {
	updateCode2();
});

// sync the scroll bar position between textarea and code block
textarea2.addEventListener("scroll", () => {
	codeBlock2.scrollTop = textarea2.scrollTop;
	codeBlock2.scrollLeft = textarea2.scrollLeft;
});

 textarea3.addEventListener("input", () => {
	updateCode3();
});

// sync the scroll bar position between textarea and code block
textarea3.addEventListener("scroll", () => {
	codeBlock3.scrollTop = textarea3.scrollTop;
	codeBlock3.scrollLeft = textarea3.scrollLeft;
});

 textarea4.addEventListener("input", () => {
	updateCode4();
});

// sync the scroll bar position between textarea and code block
textarea4.addEventListener("scroll", () => {
	codeBlock4.scrollTop = textarea4.scrollTop;
	codeBlock4.scrollLeft = textarea4.scrollLeft;
});

 textarea5.addEventListener("input", () => {
	updateCode5();
});

// sync the scroll bar position between textarea and code block
textarea5.addEventListener("scroll", () => {
	codeBlock5.scrollTop = textarea5.scrollTop;
	codeBlock5.scrollLeft = textarea5.scrollLeft;
});

 textarea6.addEventListener("input", () => {
	updateCode6();
});

// sync the scroll bar position between textarea and code block
textarea6.addEventListener("scroll", () => {
	codeBlock6.scrollTop = textarea6.scrollTop;
	codeBlock6.scrollLeft = textarea6.scrollLeft;
});

 textarea7.addEventListener("input", () => {
	updateCode7();
});

// sync the scroll bar position between textarea and code block
textarea7.addEventListener("scroll", () => {
	codeBlock7.scrollTop = textarea7.scrollTop;
	codeBlock7.scrollLeft = textarea7.scrollLeft;
});

 textarea8.addEventListener("input", () => {
	updateCode8();
});

// sync the scroll bar position between textarea and code block
textarea8.addEventListener("scroll", () => {
	codeBlock8.scrollTop = textarea8.scrollTop;
	codeBlock8.scrollLeft = textarea8.scrollLeft;
});

 textarea9.addEventListener("input", () => {
	updateCode9();
});

// sync the scroll bar position between textarea and code block
textarea9.addEventListener("scroll", () => {
	codeBlock9.scrollTop = textarea9.scrollTop;
	codeBlock9.scrollLeft = textarea9.scrollLeft;
});

 textarea10.addEventListener("input", () => {
	updateCode10();
});

// sync the scroll bar position between textarea and code block
textarea10.addEventListener("scroll", () => {
	codeBlock10.scrollTop = textarea10.scrollTop;
	codeBlock10.scrollLeft = textarea10.scrollLeft;
});

 textarea11.addEventListener("input", () => {
	updateCode11();
});

// sync the scroll bar position between textarea and code block
textarea11.addEventListener("scroll", () => {
	codeBlock11.scrollTop = textarea11.scrollTop;
	codeBlock11.scrollLeft = textarea11.scrollLeft;
});

 textarea12.addEventListener("input", () => {
	updateCode12();
});

// sync the scroll bar position between textarea and code block
textarea12.addEventListener("scroll", () => {
	codeBlock12.scrollTop = textarea12.scrollTop;
	codeBlock12.scrollLeft = textarea12.scrollLeft;
});

 textarea13.addEventListener("input", () => {
	updateCode13();
});

// sync the scroll bar position between textarea and code block
textarea13.addEventListener("scroll", () => {
	codeBlock13.scrollTop = textarea13.scrollTop;
	codeBlock13.scrollLeft = textarea13.scrollLeft;
});

// applying shortcut keys
textarea1.addEventListener('keydown', function (e) {

	// [Enter] key pressed detected
	if (e.key === 'Enter') {

		// Prevent the default behavior (new line)
		e.preventDefault();

		// Get the cursor position
		var cursorPos = textarea1.selectionStart;

		// Get the previous line
		var prevLine = textarea1.value.substring(0, cursorPos).split('\n').slice(-1)[0];

		// Get the indentation of the previous line
		var indent = prevLine.match(/^\s*/)[0];

		// Add a new line with the same indentation
		textarea1.setRangeText('\n' + indent, cursorPos, cursorPos, 'end');

		// remove focus
		textarea1.blur();

		// regain focus (this is force the textarea scroll to caret position in case the caret falls out the textarea visible area)
		textarea1.focus();

		// copy the code from textarea to code block      
		updateCode();
		return;
	}

	// [Tab] pressed, but no [Shift]
	if (e.key === "Tab" && !e.shiftKey &&

		// and no highlight detected
		textarea1.selectionStart == textarea1.selectionEnd) {

		// suspend default behaviour
		e.preventDefault();

		// Get the current cursor position
		let cursorPosition = textarea1.selectionStart;

		// Insert 4 white spaces at the cursor position
		let newValue = textarea1.value.substring(0, cursorPosition) + "    " +
			textarea1.value.substring(cursorPosition);

		// Update the textarea value and cursor position
		textarea1.value = newValue;
		textarea1.selectionStart = cursorPosition + 4;
		textarea1.selectionEnd = cursorPosition + 4;

		// copy the code from textarea to code block      
		updateCode();
		return;
	}

	// [Tab] and [Shift] keypress presence
	if (e.key === "Tab" && e.shiftKey &&

		// no highlight detected
		textarea1.selectionStart == textarea1.selectionEnd) {

		// suspend default behaviour
		e.preventDefault();

		// Get the current cursor position
		let cursorPosition = textarea1.selectionStart;

		// Check the previous characters for spaces
		let leadingSpaces = 0;
		for (let i = 0; i < 4; i++) {
			if (textarea1.value[cursorPosition - i - 1] === " ") {
				leadingSpaces++;
			} else {
				break;
			}
		}

		if (leadingSpaces > 0) {
			// Remove the spaces
			let newValue = textarea1.value.substring(0, cursorPosition - leadingSpaces) +
				textarea1.value.substring(cursorPosition);

			// Update the textarea value and cursor position
			textarea1.value = newValue;
			textarea1.selectionStart = cursorPosition - leadingSpaces;
			textarea1.selectionEnd = cursorPosition - leadingSpaces;
		}

		// copy the code from textarea to code block
		updateCode();
		return;
	}

	// [Tab] key pressed and range selection detected
	if (e.key == 'Tab' & textarea1.selectionStart != textarea1.selectionEnd) {
		e.preventDefault();

		// split the textarea content into lines
		let lines = this.value.split('\n');

		// find the start/end lines
		let startPos = this.value.substring(0, this.selectionStart).split('\n').length - 1;
		let endPos = this.value.substring(0, this.selectionEnd).split('\n').length - 1;

		// calculating total removed white spaces
		// these values will be used for adjusting new cursor position
		let spacesRemovedFirstLine = 0;
		let spacesRemoved = 0;

		// [Shift] key was pressed (this means we're un-indenting)
		if (e.shiftKey) {

			// iterate over all lines
			for (let i = startPos; i <= endPos; i++) {

				// /^ = from the start of the line,
				// {1,4} = remove in between 1 to 4 white spaces that may existed
				lines[i] = lines[i].replace(/^ {1,4}/, function (match) {

					// "match" is a string (white space) extracted

					// obtaining total white spaces removed

					// total white space removed at first line
					if (i == startPos)
						spacesRemovedFirstLine = match.length;

					// total white space removed overall
					spacesRemoved += match.length;

					return '';
				});
			}
		}

		// no shift key, so we're indenting
		else {
			// iterate over all lines
			for (let i = startPos; i <= endPos; i++) {
				// add a tab to the start of the line
				lines[i] = '    ' + lines[i]; // four spaces
			}
		}

		// remember the cursor position
		let start = this.selectionStart;
		let end = this.selectionEnd;

		// put the modified lines back into the textarea
		this.value = lines.join('\n');

		// adjust the position of cursor start selection
		this.selectionStart = e.shiftKey ?
			start - spacesRemovedFirstLine : start + 4;

		// adjust the position of cursor end selection
		this.selectionEnd = e.shiftKey ?
			end - spacesRemoved : end + 4 * (endPos - startPos + 1);

		// copy the code from textarea to code block      
		updateCode();
		return;
	}

	// [Shift] + [Del]/[Backspace] = Delete entire line(s)
	if (e.shiftKey && (e.key === "Delete" || e.key === "Backspace")) {

		e.preventDefault();

		// find the start/end lines
		let startPos = this.value.substring(0, this.selectionStart).split('\n').length - 1;
		let endPos = this.value.substring(0, this.selectionEnd).split('\n').length - 1;

		// get the line and the position in that line where the cursor is
		// pop() = take out the last line (which is the cursor selection start located)
		let cursorLine = this.value.substring(0, this.selectionStart).split('\n').pop();

		// get the position of cursor within the last line
		let cursorPosInLine = cursorLine.length;

		// calculating total lines to be removed
		let totalLinesRemove = endPos - startPos + 1;

		// split the textarea content into lines
		let lines = this.value.split('\n');

		// calculate new cursor position
		let newStart = lines.slice(0, startPos).join('\n').length + (startPos > 0 ? 1 : 0);
		// add 1 if startPos > 0 to account for '\n' character

		// remove the selected lines
		lines.splice(startPos, totalLinesRemove);

		// get the new line where the cursor will be after deleting lines
		// if lines[startPos] is not existed, then the new line will be an empty string
		let newLine = lines[startPos] || '';

		// if the new line is shorter than the cursor position, put the cursor at the end of the line
		if (newLine.length < cursorPosInLine) {
			cursorPosInLine = newLine.length;
		}

		// adjuct the cursor's position in the line to the new cursor position
		newStart += cursorPosInLine;

		// put the modified lines back into the textarea
		this.value = lines.join('\n');

		// set the new cursor position
		// both cursor selection start and end will be at the same position
		this.selectionStart = this.selectionEnd = newStart;

		// copy the code from textarea to code block      
		updateCode();
		return;
	}

	// Move cursor to the first non-white space character
	if (e.key === "Home") {

		// get the line and the position in that line where the cursor is
		// pop() = take out the last line (which is the cursor selection start located)
		let line = this.value.substring(0, this.selectionStart).split('\n').pop();

		// get the position of cursor within the last line
		let cursorPosInLine = line.length;

		// Find the start of the current line
		let lineStartPos = this.value.substring(0, this.selectionStart).lastIndexOf('\n') + 1;

		// Find the first non-whitespace character on the line
		let firstNonWhitespacePos = line.search(/\S/);

		// the cursor's position is already in front of first non-whitespace character,
		// or it's position is before first none-whitespace character,
		// move the cursor to the start of line
		if (firstNonWhitespacePos >= cursorPosInLine) {
			// do nothing, perform default behaviour, which is moving the cursor to beginning of the line
			return true;
		}
		// If there's no non-whitespace character, this is an empty or whitespace-only line
		else if (firstNonWhitespacePos === -1) {
			// do nothing, perform default behaviour, which is moving the cursor to beginning of the line
			return true;
		}

		// Prevent the default Home key behavior
		e.preventDefault();

		// Move the cursor to the position of the first non-whitespace character
		this.selectionStart = this.selectionEnd = lineStartPos + firstNonWhitespacePos;

		return;
	}


});