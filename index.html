<html>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<style>
		body{
			font-family: monospace;
			font-size: 16px;
			margin: 16px;
			width: 410px;
			height: 410px;
		}
		
		.hex, .contrast{
			display: inline-block;
			margin-top: 14px;
		}
		
		.hex input{
			text-transform:uppercase;
		}
		
		.square{
			border: 2px solid #000;
			background: #808080;
			height: 72px;
			width: 84px;
			float: right;
			margin-top: -40px;
		}
		
		.error {
			color: #FF0000;
			display: inline-block;
			margin-top: 4px;
		}
		
		#submit{
			margin-top: 24px;
			width: 20%;
		}
		
		#submit:hover{
			cursor: pointer;
		}
	</style>
	<body>
		<h2 id="title">HEX to koko-aio Color Converter</h2>
		 <form name="color-convert" method="post" onsubmit="return false;" autocomplete="off">
			BEZEL_R = "<span id="bezel-r">0.000000</span>"<br>
			BEZEL_G = "<span id="bezel-g">0.000000</span>"<br>
			BEZEL_B = "<span id="bezel-b">0.000000</span>"<br>
			BEZEL_CON = "<span id="contrast">1.300000</span>"<br><br>
			<div class="hex">HEX: # <input type="text" name="hex" placeholder="808080"></div>
			<div class="contrast">Contrast: <input type="text" name="contrast" placeholder="1.30"></div>
			<div class="square"></div>
			<span class="error"></span>
			<br>
			<br>
			<input type="submit" name="submit" value="Convert" id="submit">
		</form>
	</body>
	<script>
		$(document).ready(function () {
			$("form").submit(function (event) {
				var hex = $(".hex input").val();
					contrast = $(".contrast input").val();
					
				if(contrast == ""){
					contrast = "1.30";
					contrastError = "false";
				}
				else if(contrast < 0.01 || contrast > 3.75){
					contrastError = "true";
				}
				else{
					contrast = parseFloat($(".contrast input").val()).toFixed(2);
					contrastError = "false";
				}
				
				if(/^[0-9A-F]{6}$/i.test(hex) == false){
					hexError = "true";
				}
				else if(contrastError == "false"){
					function hexToRgb(color) {
						var rgb = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(color);
						
						return rgb ? {
							r: parseInt(rgb[1], 16),
							g: parseInt(rgb[2], 16),
							b: parseInt(rgb[3], 16)
						} : null;
					}
					
					hexError = "false";
					
					if(contrast < 1){
						$('#bezel-r').text((((hexToRgb(hex).r - 128) * (0.395 - (contrast - 1.30) * ((3.75 - contrast) * (contrast * .1 + .105) + (contrast * .01 + .0105))) / 128)).toFixed(10));
						$('#bezel-g').text((((hexToRgb(hex).g - 128) * (0.395 - (contrast - 1.30) * ((3.75 - contrast) * (contrast * .1 + .105) + (contrast * .01 + .0105))) / 128)).toFixed(10));
						$('#bezel-b').text((((hexToRgb(hex).b - 128) * (0.395 - (contrast - 1.30) * ((3.75 - contrast) * (contrast * .01 + .055) + (contrast * .001 + .0055))) / 128)).toFixed(10));
					}
					else{
						$('#bezel-r').text((((hexToRgb(hex).r - 128) * (0.395 - (contrast - 1.30) * ((3.75 - contrast) * (contrast * .01 + .105) + (contrast * .001 + .0105))) / 128)).toFixed(10));
						$('#bezel-g').text((((hexToRgb(hex).g - 128) * (0.395 - (contrast - 1.30) * ((3.75 - contrast) * (contrast * .01 + .105) + (contrast * .001 + .0105))) / 128)).toFixed(10));
						$('#bezel-b').text((((hexToRgb(hex).b - 128) * (0.395 - (contrast - 1.30) * ((3.75 - contrast) * (contrast * .001 + .055) + (contrast * .0001 + .0055))) / 128)).toFixed(10));
					}
					
					
					$(".square").css("background", "#"+hex);
					$("#contrast").text(contrast+"0000");
				}
				
				if(contrastError == "true"){
					$(".error").text("Contrast must be between 0.01 and 3.75");
				}
				else if(hexError == "true"){
					$(".error").text("Input needs to be a RRGGBB value");
				}
				else{
					$(".error").empty();
				}	

				event.preventDefault();
				
				});
		});
	</script>
</html>
